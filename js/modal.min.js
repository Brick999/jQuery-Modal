/**
 * @name        jQuery Modal
 * @author      Matt Hinchliffe <https://github.com/i-like-robots/jQuery-Modal>
 * @modified    06/08/2012
 * @version     0.9.0
 */
;(function(b,c){function a(e,d){this.opts=b.extend({},{onopen:c,onclose:c,onupdate:c,width:640,maxWidth:"95%",height:480,maxHeight:"95%",fixed:false,overlay:true,blur:true,escape:true},d);this.target=e;return this}a.prototype={isOpen:false,isInitialized:false,_init:function(){if(this.isInitialized){return}this.doc=b(document);this.wrapper=b('<div class="modal-wrapper"><span class="modal-close" data-toggle="modal">Close</span></div>').css({position:this.opts.fixed?"fixed":"absolute",width:this.opts.width,maxWidth:this.opts.maxWidth,height:this.opts.height,maxHeight:this.opts.maxHeight,display:"none"});this.content=b('<div class="modal-content" />').appendTo(this.wrapper);this.wrapper.appendTo(this.target);if(this.opts.overlay){this.overlay=b('<div class="modal-overlay"'+(this.opts.blur?'data-toggle="modal"':"")+" />").css({position:"absolute",top:0,left:0,width:"100%",display:"none"}).appendTo(this.target)}this.isBody=(this.target===document.body);this.context=this.isBody?b(window):b(this.target).css("position","relative");this.isInitialized=true},align:function(){var d=this.wrapper.height(),e=this.wrapper.width(),g=this.context.height(),f=this.context.width(),h=this.opts.fixed?0:this.context.scrollTop();this.wrapper.css({top:d<g?((g-d)/2)+h:h,left:e<f?(f-e)/2:0});if(this.opts.overlay){this.overlay.css("height",this.isBody?this.doc.height():g)}},open:function(e,f){if(!this.isInitialized){this._init()}else{if(this.isOpen){return}}var d=this;if(this.isBody){this.context.on("resize.modal",function(){d.align()});this.doc.on("keyup.modal",function(g){if(g.keyCode===27){d.close()}})}this.doc.on("click.modal",'[data-toggle="modal"]',function(g){g.preventDefault();d.close()});this.wrapper.add(this.overlay).stop().fadeIn();this.isOpen=true;if(e){this.update(e)}if(this.opts.onopen){this.opts.onopen.call(this)}if(f){f.call(this)}},update:function(d,e){this.content.html(d);if(this.isOpen){this.align()}if(this.opts.onupdate){this.opts.onupdate.call(this)}if(e){e.call(this)}},resize:function(e,d){this.wrapper.css({width:e,height:d});this.align()},close:function(e){if(!this.isInitialized||!this.isOpen){return}var d=this;this.doc.off(".modal");this.wrapper.add(this.overlay).stop().fadeOut(function(){d.content[0].innerHTML=""});this.isOpen=false;if(this.opts.onclose){this.opts.onclose.call(this)}if(e){e.call(this)}}};b.fn.modal=function(d){return this.each(function(){if(!b.data(this,"modal")){b.data(this,"modal",new a(this,d))}})}})(jQuery);